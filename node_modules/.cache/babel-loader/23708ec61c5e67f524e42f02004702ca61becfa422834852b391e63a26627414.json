{"ast":null,"code":"import CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\nimport LoadingVue from 'vue3-loading-overlay';\nexport default {\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {},\n      isNew: true,\n      isLoading: false\n    };\n  },\n  components: {\n    CouponModal,\n    DelModal\n  },\n  inject: {\n    emitter: 'emitter'\n  },\n  methods: {\n    getCoupons() {\n      this.isLoading = true;\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      console.log(api);\n      this.$http.get(api).then(res => {\n        if (res.data.success) {\n          this.coupons = res.data.coupons;\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    },\n    updateCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n      console.log(api);\n      this.$http.post(api, {\n        data: this.tempCoupon\n      }).then(res => {\n        if (res.data.success) {\n          console.log(res.data);\n          this.coupons = res.data.coupons;\n          const {\n            couponModal\n          } = this.$refs;\n          couponModal.hideModal();\n          this.getCoupons();\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    },\n    delCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n      this.$http.delete(api).then(res => {\n        if (res.data.success) {\n          const delModalComponent = this.$refs.delModal;\n          delModalComponent.hideModal();\n          this.getCoupons();\n        }\n      });\n    },\n    openModal(isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {};\n      } else {\n        this.tempCoupon = {\n          ...item\n        };\n      }\n      this.isNew = isNew;\n      const {\n        couponModal\n      } = this.$refs;\n      couponModal.showModal();\n    },\n    openDelModal(item) {\n      this.tempCoupon = {\n        ...item\n      };\n      const {\n        delModal\n      } = this.$refs;\n      delModal.showModal();\n    }\n  },\n  created() {\n    this.getCoupons();\n  }\n};","map":{"version":3,"names":["CouponModal","DelModal","LoadingVue","data","coupons","tempCoupon","isNew","isLoading","components","inject","emitter","methods","getCoupons","api","process","env","VUE_APP_API","VUE_APP_PATH","console","log","$http","get","then","res","success","catch","e","updateCoupon","post","couponModal","$refs","hideModal","delCoupon","id","delete","delModalComponent","delModal","openModal","item","showModal","openDelModal","created"],"sources":["C:\\Users\\yifan\\Desktop\\homework\\vuejs\\alley-vueproj\\src\\views\\Coupons.vue"],"sourcesContent":["<template>\n  <Loading :active=\"isLoading\"></Loading>\n  <div>\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary\" @click=\"openModal(true)\">\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n      <tr>\n        <th>名稱</th>\n        <th>折扣百分比</th>\n        <th>到期日</th>\n        <th>是否啟用</th>\n        <th>編輯</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n        <!-- <td>名稱</td> -->\n        <td>{{item.title}}</td>\n        <td>{{item.percent}}%</td>\n        <td>{{$filters.date(item.due_date)}}</td>\n        <td>\n          <span class=\"text-success\" v-if=\"item.is_enabled\">啟用</span>\n          <span class=\"text-success\" v-else>未啟用</span>\n        </td>\n        <td>\n          <div class=\"btn-group\">\n            <button class=\"btn btn-outline-primary btn-sm\" @click=\"openModal(false, item)\"\n            >編輯</button>\n            <button class=\"btn btn-outline-danger btn-sm\"\n            @click=\"openDelModal(item)\"\n            >刪除</button>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n\n  </div>\n  <CouponModal ref=\"couponModal\" @update-coupon=\"updateCoupon\" :coupon=\"tempCoupon\"></CouponModal>\n  <DelModal ref=\"delModal\" :delProduct=\"tempCoupon\" @delete-item=\"delCoupon\"></DelModal>\n</template>\n\n<script>\nimport CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\nimport LoadingVue from 'vue3-loading-overlay';\n\nexport default {\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {},\n      isNew: true,\n      isLoading: false,\n    };\n  },\n  components: {\n    CouponModal,\n    DelModal,\n  },\n  inject: {\n    emitter: 'emitter',\n  },\n  methods: {\n    getCoupons() {\n      this.isLoading = true;\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      console.log(api);\n      this.$http.get(api)\n        .then((res) => {\n          if (res.data.success) {\n            this.coupons = res.data.coupons;\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    updateCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n      console.log(api);\n      this.$http.post(api, { data: this.tempCoupon })\n        .then((res) => {\n          if (res.data.success) {\n            console.log(res.data);\n            this.coupons = res.data.coupons;\n            const { couponModal } = this.$refs;\n            couponModal.hideModal();\n            this.getCoupons();\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    delCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempCoupon.id}`;\n      this.$http.delete(api)\n        .then((res) => {\n          if (res.data.success) {\n            const delModalComponent = this.$refs.delModal;\n            delModalComponent.hideModal();\n            this.getCoupons();\n          }\n        });\n    },\n    openModal(isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {};\n      } else {\n        this.tempCoupon = { ...item };\n      }\n      this.isNew = isNew;\n      const { couponModal } = this.$refs;\n      couponModal.showModal();\n    },\n    openDelModal(item) {\n      this.tempCoupon = { ...item };\n      const { delModal } = this.$refs;\n      delModal.showModal();\n    },\n\n  },\n  created() {\n    this.getCoupons();\n  },\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}