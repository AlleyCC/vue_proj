{"ast":null,"code":"import CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\nexport default {\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {},\n      isNew: true\n    };\n  },\n  components: {\n    CouponModal,\n    DelModal\n  },\n  inject: {\n    emitter: 'emitter'\n  },\n  methods: {\n    getCoupons() {\n      console.log('getCoupons');\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      console.log(api);\n      this.$http.get(api).then(res => {\n        if (res.data.success) {\n          console.log(res.data);\n          this.coupons = res.data.coupons;\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    },\n    updateCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n      console.log(api);\n      this.$http.post(api, {\n        data: this.tempCoupon\n      }).then(res => {\n        if (res.data.success) {\n          console.log(res.data);\n          this.coupons = res.data.coupons;\n          const {\n            couponModal\n          } = this.$refs;\n          couponModal.hideModal();\n          this.getCoupons();\n        }\n      }).catch(e => {\n        console.log(e);\n      });\n    },\n    delCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempProduct.id}`;\n      this.$http.delete(api).then(res => {\n        if (res.data.success) {\n          const delModalComponent = this.$refs.delModal;\n          delModalComponent.hideModal();\n          this.getCoupons();\n        }\n      });\n    },\n    openModal(isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {};\n      } else {\n        this.tempCoupon = {\n          ...item\n        };\n      }\n      this.isNew = isNew;\n      const {\n        couponModal\n      } = this.$refs;\n      couponModal.showModal();\n    },\n    openDelModal() {\n      const {\n        delModal\n      } = this.$refs;\n      delModal.hideModal();\n    }\n  },\n  created() {\n    this.getCoupons();\n  }\n};","map":{"version":3,"names":["CouponModal","DelModal","data","coupons","tempCoupon","isNew","components","inject","emitter","methods","getCoupons","console","log","api","process","env","VUE_APP_API","VUE_APP_PATH","$http","get","then","res","success","catch","e","updateCoupon","post","couponModal","$refs","hideModal","delCoupon","tempProduct","id","delete","delModalComponent","delModal","openModal","item","showModal","openDelModal","created"],"sources":["C:\\Users\\yifan\\Desktop\\homework\\vuejs\\alley-vueproj\\src\\views\\Coupons.vue"],"sourcesContent":["<template>\n  <div>\n    <div class=\"text-end mt-4\">\n      <button class=\"btn btn-primary\" @click=\"openModal(true)\">\n        建立新的優惠券\n      </button>\n    </div>\n    <table class=\"table mt-4\">\n      <thead>\n      <tr>\n        <th>名稱</th>\n        <th>折扣百分比</th>\n        <th>到期日</th>\n        <th>是否啟用</th>\n        <th>編輯</th>\n      </tr>\n      </thead>\n      <tbody>\n      <tr v-for=\"(item, key) in coupons\" :key=\"key\">\n        <!-- <td>名稱</td> -->\n        <td>{{item.title}}</td>\n        <td>{{item.percent}}%</td>\n        <td>{{$filters.date(item.due_date)}}</td>\n        <td>\n          <span class=\"text-success\" v-if=\"item.is_enabled\">啟用</span>\n          <span class=\"text-success\" v-else>未啟用</span>\n        </td>\n        <td>\n          <div class=\"btn-group\">\n            <button class=\"btn btn-outline-primary btn-sm\" @click=\"openModal(false, item)\"\n            >編輯</button>\n            <button class=\"btn btn-outline-danger btn-sm\"\n            @click=\"openDelModal\"\n            >刪除</button>\n          </div>\n        </td>\n      </tr>\n      </tbody>\n    </table>\n\n  </div>\n  <CouponModal ref=\"couponModal\" @update-coupon=\"updateCoupon\" :coupon=\"tempCoupon\"></CouponModal>\n  <DelModal ref=\"delModal\" :delProduct=\"\" @delete-item=\"delCoupon\"></DelModal>\n</template>\n\n<script>\nimport CouponModal from '@/components/CouponModal.vue';\nimport DelModal from '@/components/DelModal.vue';\n\nexport default {\n  data() {\n    return {\n      coupons: [],\n      tempCoupon: {},\n      isNew: true,\n    };\n  },\n  components: {\n    CouponModal,\n    DelModal,\n  },\n  inject: {\n    emitter: 'emitter',\n  },\n  methods: {\n    getCoupons() {\n      console.log('getCoupons');\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupons`;\n      console.log(api);\n      this.$http.get(api)\n        .then((res) => {\n          if (res.data.success) {\n            console.log(res.data);\n            this.coupons = res.data.coupons;\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    updateCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon`;\n      console.log(api);\n      this.$http.post(api, { data: this.tempCoupon })\n        .then((res) => {\n          if (res.data.success) {\n            console.log(res.data);\n            this.coupons = res.data.coupons;\n            const { couponModal } = this.$refs;\n            couponModal.hideModal();\n            this.getCoupons();\n          }\n        })\n        .catch((e) => {\n          console.log(e);\n        });\n    },\n    delCoupon() {\n      const api = `${process.env.VUE_APP_API}api/${process.env.VUE_APP_PATH}/admin/coupon/${this.tempProduct.id}`;\n      this.$http.delete(api)\n        .then((res) => {\n          if (res.data.success) {\n            const delModalComponent = this.$refs.delModal;\n            delModalComponent.hideModal();\n            this.getCoupons();\n          }\n        });\n    },\n    openModal(isNew, item) {\n      if (isNew) {\n        this.tempCoupon = {};\n      } else {\n        this.tempCoupon = { ...item };\n      }\n      this.isNew = isNew;\n      const { couponModal } = this.$refs;\n      couponModal.showModal();\n    },\n    openDelModal() {\n      const { delModal } = this.$refs;\n      delModal.hideModal();\n    },\n\n  },\n  created() {\n    this.getCoupons();\n  },\n};\n</script>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}